% Copyright 2006 Konstantin Korikov <lostclus@ua.fm>
%
% This work may be distributed and/or modified under the
% conditions of the LaTeX Project Public License, either version 1.3
% of this license or (at your option) any later version.
% The latest version of this license is in
%   http://www.latex-project.org/lppl.txt
% and version 1.3 or later is part of all distributions of LaTeX
% version 2003/12/01 or later.
%
% This work has the LPPL maintenance status "maintained".
% 
% This Current Maintainer of this work is Konstantin Korikov.
%
% This work consists of all files listed in manifest.txt.
%
m4_ESKDX_INIT
m4_FILE_INIT
\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{eskdstamp}[
m4_FILE_ID([[$Date$]]) Stamp GOST 2.104-68]

\RequirePackage{calc}
\RequirePackage{ifthen}

% формат бумаги:
\newcommand{\ESKD@paper}{a4}

% ориентация страницы
\newif\ifESKD@landscape
\ESKD@landscapefalse
\newif\ifESKD@given@landscape
\ESKD@given@landscapefalse

% стиль по умолчанию
\newcommand{\ESKD@default@style}{}

% поля
\newlength{\ESKD@margin@si}
\newlength{\ESKD@margin@so}
\newlength{\ESKD@margin@t}
\newlength{\ESKD@margin@b}
\setlength{\ESKD@margin@si}{20mm}
\setlength{\ESKD@margin@so}{5mm}
\setlength{\ESKD@margin@t}{5mm}
\setlength{\ESKD@margin@b}{5mm}

% толщина линий
\newlength{\ESKDlineThick}
\newlength{\ESKDlineThin}
\setlength{\ESKDlineThick}{.4mm}
\setlength{\ESKDlineThin}{.2mm}

% расстояние между рамкой и текстом
\newlength{\ESKD@padding@h}
\newlength{\ESKD@padding@v}
\setlength{\ESKD@padding@h}{3mm}
\setlength{\ESKD@padding@v}{10mm}

\newif\ifESKD@ignstamp
\ESKD@ignstampfalse

\newif\ifESKD@enable@column@vii
\ESKD@enable@column@viitrue
\newif\ifESKD@given@column@vii
\ESKD@given@column@viifalse

\newif\ifESKD@enable@column@viii
\ESKD@enable@column@viiitrue

\newif\ifESKD@enable@columns@xix
\ESKD@enable@columns@xixtrue

\newif\ifESKD@enable@columns@xxiv
\ESKD@enable@columns@xxivfalse

\newif\ifESKD@enable@column@xxvi
\ESKD@enable@column@xxvifalse

\newif\ifESKD@enable@columns@xxvii
\ESKD@enable@columns@xxviifalse

\newif\ifESKD@enable@column@xxxii
\ESKD@enable@column@xxxiitrue

\newif\ifESKD@enable@column@xxxiii
\ESKD@enable@column@xxxiiifalse

\newif\ifESKD@enable@column@xxxiv
\ESKD@enable@column@xxxivfalse

\newif\ifESKD@twoside
\ESKD@twosidefalse

\newif\ifESKD@zonelabels
\ESKD@zonelabelsfalse

\RequirePackage{keyval}

% определение опций
\DeclareOption{a0paper}{\renewcommand{\ESKD@paper}{a0}}
\DeclareOption{a1paper}{\renewcommand{\ESKD@paper}{a1}}
\DeclareOption{a2paper}{\renewcommand{\ESKD@paper}{a2}}
\DeclareOption{a3paper}{\renewcommand{\ESKD@paper}{a3}}
\DeclareOption{a4paper}{\renewcommand{\ESKD@paper}{a4}}
\DeclareOption{landscape}{%
  \ESKD@landscapetrue%
  \ESKD@given@landscapetrue}
\DeclareOption{portrait}{%
  \ESKD@landscapefalse%
  \ESKD@given@landscapetrue}
\define@key{eskd}{reduceheight}{\addtolength{\ESKD@margin@b}{#1}}
\DeclareOption{formI}{\renewcommand{\ESKD@default@style}{formI}}
\DeclareOption{formII}{\renewcommand{\ESKD@default@style}{formII}}
\DeclareOption{emptystyle}{\renewcommand{\ESKD@default@style}{empty}}
\DeclareOption{stitching}{\setlength{\ESKD@margin@si}{20mm}}
\DeclareOption{nostitching}{%
  \setlength{\ESKD@margin@si}{5mm}%
  \ESKD@enable@columns@xixfalse%
  \ESKD@enable@columns@xxivfalse}
\DeclareOption{ignorestamp}{\ESKD@ignstamptrue}
\DeclareOption{noignorestamp}{\ESKD@ignstampfalse}
\DeclareOption{columnvii}{%
  \ESKD@enable@column@viitrue%
  \ESKD@given@column@viitrue}
\DeclareOption{nocolumnvii}{
  \ESKD@enable@column@viifalse%
  \ESKD@given@column@viitrue}
\DeclareOption{columnviii}{\ESKD@enable@column@viiitrue}
\DeclareOption{nocolumnviii}{\ESKD@enable@column@viiifalse}
\DeclareOption{columnsxix}{\ESKD@enable@columns@xixtrue}
\DeclareOption{nocolumnsxix}{\ESKD@enable@columns@xixfalse}
\DeclareOption{columnsxxiv}{\ESKD@enable@columns@xxivtrue}
\DeclareOption{nocolumnsxxiv}{\ESKD@enable@columns@xxivfalse}
\DeclareOption{columnxxvi}{\ESKD@enable@column@xxvitrue}
\DeclareOption{nocolumnxxvi}{\ESKD@enable@column@xxvifalse}
\DeclareOption{columnsxxvii}{\ESKD@enable@columns@xxviitrue}
\DeclareOption{nocolumnsxxvii}{\ESKD@enable@columns@xxviifalse}
\DeclareOption{columnxxxii}{\ESKD@enable@column@xxxiitrue}
\DeclareOption{nocolumnxxxii}{\ESKD@enable@column@xxxiifalse}
\DeclareOption{columnxxxiii}{\ESKD@enable@column@xxxiiitrue}
\DeclareOption{nocolumnxxxiii}{\ESKD@enable@column@xxxiiifalse}
\DeclareOption{columnxxxiv}{\ESKD@enable@column@xxxivtrue}
\DeclareOption{nocolumnxxxiv}{\ESKD@enable@column@xxxivfalse}
\DeclareOption{simple}{%
  \ESKD@enable@columns@xixfalse%
  \ESKD@enable@column@xxxiifalse}
\DeclareOption{twoside}{\ESKD@twosidetrue}
\DeclareOption{oneside}{\ESKD@twosidefalse}
\DeclareOption{zonelabels}{\ESKD@zonelabelstrue}
\DeclareOption{nozonelabels}{\ESKD@zonelabelsfalse}
\define@key{eskd}{linethick}{\setlength{\ESKDlineThick}{#1}}
\define@key{eskd}{linethin}{\setlength{\ESKDlineThin}{#1}}
\define@key{eskd}{vpadding}{\setlength{\ESKD@padding@v}{#1}}
\define@key{eskd}{hpadding}{\setlength{\ESKD@padding@h}{#1}}

\DeclareOption*{\edef\@tempa{\noexpand\setkeys{eskd}{\CurrentOption}}\@tempa}

\ProcessOptions\relax

% некоторые константы для сравнения
\newcommand{\ESKD@cmp@empty}{}
\newcommand{\ESKD@cmp@aIVpaper}{a4}
\newcommand{\ESKD@cmp@landscape}{landscape}
\newcommand{\ESKD@cmp@formI}{formI}
\newcommand{\ESKD@cmp@formII}{formII}

% определение ориентации страницы
\ifESKD@given@landscape\else
  \ifx\ESKD@paper\ESKD@cmp@aIVpaper%
    \ESKD@landscapefalse
    \else
    \ESKD@landscapetrue
  \fi
\fi

% настройка геометрии страницы
\RequirePackage[\ESKD@paper paper,%
\ifESKD@landscape landscape\else portrait\fi,%
tmargin=\ESKD@margin@t+\ESKD@padding@v,%
bmargin=\ESKD@margin@b+\ESKD@padding@v,%
inner=\ESKD@margin@si+\ESKD@padding@h,%
outer=\ESKD@margin@so+\ESKD@padding@h,%
headheight=0mm,headsep=0mm,footskip=0mm]{geometry}

% оперделение стиля по умолчанию
\ifx\ESKD@default@style\ESKD@cmp@empty%
  \ifx\ESKD@paper\ESKD@cmp@aIVpaper%
    \renewcommand{\ESKD@default@style}{formII}%
    \else
    \renewcommand{\ESKD@default@style}{formI}%
  \fi
\fi

\RequirePackage{lastpage}

\def\ESKD@secondof#1#2#3endof{#2}
\def\ESKD@p@genum#1{%
  \ifx#1\relax 0\else
   \expandafter\ESKD@secondof#1endof
  \fi}
\def\ESKD@pagenum#1{\expandafter\ESKD@p@genum\csname r@#1\endcsname}

% нужна ли графа 7
\ifESKD@given@column@vii\else
  \AtBeginDocument{%
    \ifnum \ESKD@pagenum{LastPage} = 1
      \ESKD@enable@column@viifalse%
    \fi}
\fi

% определение ориентации графы 26
\newif\ifESKD@column@xxvi@portrait
\ESKD@column@xxvi@portraittrue
\ifESKD@landscape\ESKD@column@xxvi@portraitfalse\fi
\ifx\ESKD@paper\ESKD@cmp@aIVpaper\ESKD@column@xxvi@portraitfalse\fi

% временные длины
\newlength{\ESKD@tmpdima}
\newlength{\ESKD@tmpdimb}
\newlength{\ESKD@tmpdimc}

% временные счетчики
\newcount\ESKD@tmpcnta
\newcount\ESKD@tmpcntb

% параметры отметок зон
\newcount\ESKD@zonelabel@hc
\newcount\ESKD@zonelabel@vc
\newlength{\ESKD@zonelabel@hs}
\newlength{\ESKD@zonelabel@vs}
\newcount\ESKD@zonelabel@cnt
\ifESKD@zonelabels
  \@namedef{ESKD@zonelabel@init@a4}{%
    \ESKD@zonelabel@hc = 1 \ESKD@zonelabel@vc = 1\relax}
  \@namedef{ESKD@zonelabel@init@a3}{%
    \ESKD@zonelabel@hc = 1 \ESKD@zonelabel@vc = 2\relax}
  \@namedef{ESKD@zonelabel@init@a2}{%
    \ESKD@zonelabel@hc = 2 \ESKD@zonelabel@vc = 2\relax}
  \@namedef{ESKD@zonelabel@init@a1}{%
    \ESKD@zonelabel@hc = 2 \ESKD@zonelabel@vc = 4\relax}
  \@namedef{ESKD@zonelabel@init@a0}{%
    \ESKD@zonelabel@hc = 4 \ESKD@zonelabel@vc = 4\relax}
  \@nameuse{ESKD@zonelabel@init@\ESKD@paper}
  \ifESKD@landscape
    \ESKD@tmpcnta = \ESKD@zonelabel@hc
    \ESKD@zonelabel@hc = \ESKD@zonelabel@vc
    \ESKD@zonelabel@vc = \ESKD@tmpcnta
  \fi
  \ESKD@zonelabel@hs = \paperwidth
  \ESKD@zonelabel@vs = \paperheight
  \divide \ESKD@zonelabel@hs by \ESKD@zonelabel@hc
  \divide \ESKD@zonelabel@vs by \ESKD@zonelabel@vc
  \ESKD@zonelabel@cnt = 0
\fi

% нижний левый край страницы
\newlength{\ESKD@origin@x}
\newlength{\ESKD@origin@y}
\setlength{\ESKD@origin@x}{1in}
\setlength{\ESKD@origin@y}{\paperheight-1in}

% позиция рамки
\newlength{\ESKDframeX}
\newlength{\ESKDframeY}

% ширина и высота рамки
\newlength{\ESKDframeW}
\newlength{\ESKDframeH}
\setlength{\ESKDframeW}{\paperwidth-\ESKD@margin@si-\ESKD@margin@so}
\setlength{\ESKDframeH}{\paperheight-\ESKD@margin@t-\ESKD@margin@b}

% позиция штампа
\newlength{\ESKDstampX}
\newlength{\ESKDstampY}

\RequirePackage{eskdfont}
\RequirePackage{eskdlang}

% переводит длинну в единицу
\newcommand*{\ESKDltu}[1]{#1\@gobble}

% расширяется в аргумент только на передней стороне листа
\newcommand{\ESKDonFrontSideOnly}[1]{%
  \ifESKD@twoside\ifodd\c@page#1\fi\else#1\fi}

\RequirePackage{rotating}

% рамка
\newsavebox{\ESKD@frame@box}
\newcommand{\ESKD@make@frame@box}{%
\savebox{\ESKD@frame@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,\ESKDltu{\ESKDframeH}){\line(1,0){\ESKDltu{\ESKDframeW}}}
\put(0,0){\line(1,0){\ESKDltu{\ESKDframeW}}}
\put(0,0){\line(0,1){\ESKDltu{\ESKDframeH}}}
\put(\ESKDltu{\ESKDframeW},0){\line(0,1){\ESKDltu{\ESKDframeH}}}
\end{picture}}}

% штамп форма 1
\newsavebox{\ESKD@stamp@i@box}
\newcommand{\ESKD@make@stamp@i@box}{%
\savebox{\ESKD@stamp@i@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,55){\line(1,0){185}}
\put(65,40){\line(1,0){120}}
\put(0,35){\line(1,0){65}}
\put(135,35){\line(1,0){50}}
\put(0,30){\line(1,0){65}}
\put(135,20){\line(1,0){50}}
\put(65,15){\line(1,0){120}}
\linethickness{\ESKDlineThin}
\multiput(0,50)(0,-5){3}{\line(1,0){65}}
\multiput(0,25)(0,-5){5}{\line(1,0){65}}
\linethickness{\ESKDlineThick}
\put(0,0){\line(0,1){55}}
\put(7,30){\line(0,1){25}}
\put(17,0){\line(0,1){55}}
\put(40,0){\line(0,1){55}}
\put(55,0){\line(0,1){55}}
\put(65,0){\line(0,1){55}}
\put(135,0){\line(0,1){40}}
\put(150,20){\line(0,1){20}}
\put(155,15){\line(0,1){5}}
\put(167,20){\line(0,1){20}}
\linethickness{\ESKDlineThin}
\multiput(140,20)(5,0){2}{\line(0,1){15}}
\put(67, 41){\parbox[b][13mm][c]{106mm}{\centering\ESKDfontVII\ESKDtheColumnII}}
\put(135, 36.3){\makebox[15mm]{\ESKDfontIII\ESKDcolumnIVname}}
\put(150, 36.3){\makebox[17mm]{\ESKDfontIII\ESKDcolumnVname}}
\put(167, 36.3){\makebox[18mm]{\ESKDfontIII\ESKDcolumnVIname}}
\put(0.5, 26.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfIname}}
\put(0.5, 21.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfIIname}}
\put(0.5, 16.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfIIIname}}
\put(0.5, 11.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfIVname}}
\put(0.5, 6.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfVname}}
\put(0.5, 1.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfVIname}}
\put(17.5, 26.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfI}}
\put(17.5, 21.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfII}}
\put(17.5, 16.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfIII}}
\put(17.5, 11.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfIV}}
\put(17.5, 6.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfV}}
\put(17.5, 1.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfVI}}
\put(0, 31.3){\makebox[7mm]{\ESKDfontIII\ESKDcolumnXIVname}}
\put(7, 31.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVname}}
\put(17, 31.3){\makebox[23mm]{\ESKDfontIII\ESKDcolumnXVIname}}
\put(40, 31.3){\makebox[15mm]{\ESKDfontIII\ESKDcolumnXVIIname}}
\put(55, 31.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVIIIname}}
\end{picture}}}
\newcommand{\ESKD@stamp@i@var}{%
\begin{picture}(0,0)(0,0)
\ifnum \c@page = 1
  \put(67, 16){\parbox[b][23mm][c]{66mm}{\centering\ESKDfontV\ESKDtheColumnI}}
  \put(67, 1){\parbox[b][13mm][c]{66mm}{\centering\ESKDfontV\ESKDtheColumnIII}}
  \put(135, 26.3){\makebox[5mm]{\ESKDfontIII\ESKDtheColumnIVfI}}
  \put(140, 26.3){\makebox[5mm]{\ESKDfontIII\ESKDtheColumnIVfII}}
  \put(145, 26.3){\makebox[5mm]{\ESKDfontIII\ESKDtheColumnIVfIII}}
  \put(151, 21){\parbox[b][13mm][c]{15mm}{\centering\ESKDfontIII\ESKDtheColumnV}}
  \put(168, 21){\parbox[b][13mm][c]{16mm}{\centering\ESKDfontIII\ESKDtheColumnVI}}
  \ifESKD@enable@column@viii
    \put(155, 16.3){\makebox[30mm]{\ESKDfontIII%
      \ifESKD@twoside\ESKDcolumnVIIItwosideName\else\ESKDcolumnVIIIname\fi%
      \ \pageref{LastPage}}}
  \fi
  \put(137, 1){\parbox[b][13mm][c]{46mm}{\centering\ESKDfontV\ESKDtheColumnIX}}
\fi
\ifESKD@enable@column@vii
  \put(135, 16.3){\makebox[20mm]{\ESKDfontIII%
    \ifESKD@twoside\ESKDcolumnVIItwosideName\else\ESKDcolumnVIIname\fi\ \thepage}}
\fi
\end{picture}}

% штамп форма 2
\newsavebox{\ESKD@stamp@ii@box}
\newcommand{\ESKD@make@stamp@ii@box}{%
\savebox{\ESKD@stamp@ii@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,40){\line(1,0){185}}
\put(0,30){\line(1,0){65}}
\put(0,25){\line(1,0){185}}
\put(135,20){\line(1,0){50}}
\put(135,15){\line(1,0){50}}
\linethickness{\ESKDlineThin}
\put(0,35){\line(1,0){65}}
\multiput(0,20)(0,-5){4}{\line(1,0){65}}
\linethickness{\ESKDlineThick}
\put(0,0){\line(0,1){40}}
\put(7,25){\line(0,1){15}}
\put(17,0){\line(0,1){40}}
\put(40,0){\line(0,1){40}}
\put(55,0){\line(0,1){40}}
\put(65,0){\line(0,1){40}}
\put(135,0){\line(0,1){25}}
\put(140,15){\line(0,1){5}}
\put(145,15){\line(0,1){5}}
\put(150,15){\line(0,1){10}}
\put(165,15){\line(0,1){10}}
\put(67, 26){\parbox[b][13mm][c]{106mm}{\centering\ESKDfontVII\ESKDtheColumnII}}
\put(135, 21.3){\makebox[15mm]{\ESKDfontIII\ESKDcolumnIVname}}
\put(150, 21.3){\makebox[15mm]{\ESKDfontIII%
  \ifESKD@twoside\ESKDcolumnVIItwosideName\else\ESKDcolumnVIIname\fi}}
\put(165, 21.3){\makebox[20mm]{\ESKDfontIII%
  \ifESKD@twoside\ESKDcolumnVIIItwosideName\else\ESKDcolumnVIIIname\fi}}
\put(0.5, 21.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfIname}}
\put(0.5, 16.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfIIname}}
\put(0.5, 11.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfIVname}}
\put(0.5, 6.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfVname}}
\put(0.5, 1.3){\makebox[16mm][l]{\ESKDfontIII\ESKDcolumnXfVIname}}
\put(17.5, 21.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfI}}
\put(17.5, 16.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfII}}
\put(17.5, 11.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfIV}}
\put(17.5, 6.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfV}}
\put(17.5, 1.3){\makebox[22mm][l]{\ESKDfontIII\ESKDtheColumnXIfVI}}
\put(0, 26.3){\makebox[7mm]{\ESKDfontIII\ESKDcolumnXIVname}}
\put(7, 26.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVname}}
\put(17, 26.3){\makebox[23mm]{\ESKDfontIII\ESKDcolumnXVIname}}
\put(40, 26.3){\makebox[15mm]{\ESKDfontIII\ESKDcolumnXVIIname}}
\put(55, 26.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVIIIname}}
\end{picture}}}
\newcommand{\ESKD@stamp@ii@var}{%
\begin{picture}(0,0)(0,0)
\ifnum \c@page = 1
  \put(67, 1){\parbox[b][23mm][c]{66mm}{\centering\ESKDfontV\ESKDtheColumnI}}
  \put(135, 16.3){\makebox[5mm][c]{\ESKDfontIII\ESKDtheColumnIVfI}}
  \put(140, 16.3){\makebox[5mm][c]{\ESKDfontIII\ESKDtheColumnIVfII}}
  \put(145, 16.3){\makebox[5mm][c]{\ESKDfontIII\ESKDtheColumnIVfIII}}
  \put(137, 1){\parbox[b][13mm][c]{46mm}{\centering\ESKDfontV\ESKDtheColumnIX}}
\fi
\ifESKD@enable@column@vii
  \put(150, 16.3){\makebox[15mm]{\ESKDfontIII\thepage}}
\fi
\ifESKD@enable@column@viii
  \put(165, 16.3){\makebox[20mm]{\ESKDfontIII\pageref{LastPage}}}
\fi
\end{picture}}

% штамп форма 2а
\newsavebox{\ESKD@stamp@ii@a@box}
\newcommand{\ESKD@make@stamp@ii@a@box}{%
\savebox{\ESKD@stamp@ii@a@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,15){\line(1,0){185}}
\put(175,8){\line(1,0){10}}
\put(0,5){\line(1,0){65}}
\linethickness{\ESKDlineThin}
\put(0,10){\line(1,0){65}}
\linethickness{\ESKDlineThick}
\put(0,0){\line(0,1){15}}
\put(7,0){\line(0,1){15}}
\put(17,0){\line(0,1){15}}
\put(40,0){\line(0,1){15}}
\put(55,0){\line(0,1){15}}
\put(65,0){\line(0,1){15}}
\put(175,0){\line(0,1){15}}
\put(67, 1){\parbox[b][13mm][c]{106mm}{\centering\ESKDfontVII\ESKDtheColumnII}}
\put(175, 10.3){\makebox[10mm]{\ESKDfontIII%
  \ifESKD@twoside\ESKDcolumnVIItwosideName\else\ESKDcolumnVIIname\fi}}
\put(0, 1.3){\makebox[7mm]{\ESKDfontIII\ESKDcolumnXIVname}}
\put(7, 1.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVname}}
\put(17, 1.3){\makebox[23mm]{\ESKDfontIII\ESKDcolumnXVIname}}
\put(40, 1.3){\makebox[15mm]{\ESKDfontIII\ESKDcolumnXVIIname}}
\put(55, 1.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVIIIname}}
\end{picture}}}
\newcommand{\ESKD@stamp@ii@a@var}{%
\begin{picture}(0,0)(0,0)
\ifESKD@enable@column@vii
  \put(175, 3){\makebox[10mm]{\ESKDfontIII\thepage}}
\fi
\end{picture}}

% штамп форма 2б
\newsavebox{\ESKD@stamp@ii@b@box}
\newcommand{\ESKD@make@stamp@ii@b@box}{%
\savebox{\ESKD@stamp@ii@b@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,15){\line(1,0){185}}
\put(0,8){\line(1,0){10}}
\put(120,5){\line(1,0){65}}
\linethickness{\ESKDlineThin}
\put(120,10){\line(1,0){65}}
\linethickness{\ESKDlineThick}
\put(0,0){\line(0,1){15}}
\put(10,0){\line(0,1){15}}
\put(120,0){\line(0,1){15}}
\put(127,0){\line(0,1){15}}
\put(137,0){\line(0,1){15}}
\put(160,0){\line(0,1){15}}
\put(175,0){\line(0,1){15}}
\put(12, 1){\parbox[b][13mm][c]{106mm}{\centering\ESKDfontVII\ESKDtheColumnII}}
\put(0, 10.3){\makebox[10mm]{\ESKDfontIII%
  \ifESKD@twoside\ESKDcolumnVIItwosideName\else\ESKDcolumnVIIname\fi}}
\put(120, 1.3){\makebox[7mm]{\ESKDfontIII\ESKDcolumnXIVname}}
\put(127, 1.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVname}}
\put(137, 1.3){\makebox[23mm]{\ESKDfontIII\ESKDcolumnXVIname}}
\put(160, 1.3){\makebox[15mm]{\ESKDfontIII\ESKDcolumnXVIIname}}
\put(175, 1.3){\makebox[10mm]{\ESKDfontIII\ESKDcolumnXVIIIname}}
\end{picture}}}
\newcommand{\ESKD@stamp@ii@b@var}{%
\begin{picture}(0,0)(0,0)
\ifESKD@enable@column@vii
  \put(0, 3){\makebox[10mm]{\ESKDfontIII\thepage}}
\fi
\end{picture}}

% графы от 19 по 23
\newsavebox{\ESKD@columns@xix@box}
\newcommand{\ESKD@make@columns@xix@box}{%
\savebox{\ESKD@columns@xix@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,12){\line(1,0){145}}
\put(0,7){\line(1,0){145}}
\put(0,0){\line(0,1){12}}
\put(25,0){\line(0,1){12}}
\put(60,0){\line(0,1){12}}
\put(85,0){\line(0,1){12}}
\put(110,0){\line(0,1){12}}
\put(145,0){\line(0,1){12}}
\put(0, 8.3){\makebox[25mm]{\ESKDfontIII\ESKDcolumnXIXname}}
\put(0, 2.3){\makebox[25mm]{\ESKDfontIII\ESKDtheColumnXIX}}
\put(25, 8.3){\makebox[35mm]{\ESKDfontIII\ESKDcolumnXXname}}
\put(60, 8.3){\makebox[25mm]{\ESKDfontIII\ESKDcolumnXXIname}}
\put(60, 2.3){\makebox[25mm]{\ESKDfontIII\ESKDtheColumnXXI}}
\put(85, 8.3){\makebox[25mm]{\ESKDfontIII\ESKDcolumnXXIIname}}
\put(85, 2.3){\makebox[25mm]{\ESKDfontIII\ESKDtheColumnXXII}}
\put(110, 8.3){\makebox[35mm]{\ESKDfontIII\ESKDcolumnXXIIIname}}
\end{picture}}}

% графы 24 и 25
\newsavebox{\ESKD@columns@xxiv@box}
\newcommand{\ESKD@make@columns@xxiv@box}{%
\savebox{\ESKD@columns@xxiv@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,12){\line(1,0){120}}
\put(0,7){\line(1,0){120}}
\put(0,0){\line(0,1){12}}
\put(60,0){\line(0,1){12}}
\put(120,0){\line(0,1){12}}
\put(0, 8.3){\makebox[60mm]{\ESKDfontIII\ESKDcolumnXXIVname}}
\put(0, 2.3){\makebox[60mm]{\ESKDfontIII\ESKDtheColumnXXIV}}
\put(60, 8.3){\makebox[60mm]{\ESKDfontIII\ESKDcolumnXXVname}}
\put(60, 2.3){\makebox[60mm]{\ESKDfontIII\ESKDtheColumnXXV}}
\end{picture}}}

% графа 26
\newsavebox{\ESKD@column@xxvi@box}
\newcommand{\ESKD@make@column@xxvi@box}{%
\savebox{\ESKD@column@xxvi@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,0){\line(1,0){70}}
\put(70,0){\line(0,1){14}}
\put(1,13){\begin{turn}{180}\parbox[b][12mm][c]{68mm}{%
  \centering\ESKDfontV\ESKDtheColumnII}\end{turn}}
\end{picture}}}

% графы 27, 28, 29 для формы 1
\newsavebox{\ESKD@columns@xxvii@i@box}
\newcommand{\ESKD@make@columns@xxvii@i@box}{%
\savebox{\ESKD@columns@xxvii@i@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(14,7){\line(1,0){53}}
\put(0,0){\line(1,0){67}}
\put(14,0){\line(0,1){14}}
\put(67,0){\line(0,1){14}}
\put(0,13){\begin{turn}{180}\parbox[b][12mm][c]{14mm}{%
  \centering\ESKDfontV\ESKDtheColumnXXVII}\end{turn}}
\put(14,11.7){\begin{turn}{180}\makebox[53mm][c]{%
  \ESKDfontIII\ESKDtheColumnXXVIII}\end{turn}}
\put(14,4.7){\begin{turn}{180}\makebox[53mm][c]{%
  \ESKDfontIII\ESKDtheColumnXXIX}\end{turn}}
\end{picture}}}

% графы 27, 28, 29 для формы 2
\newsavebox{\ESKD@columns@xxvii@ii@box}
\newcommand{\ESKD@make@columns@xxvii@ii@box}{%
\savebox{\ESKD@columns@xxvii@ii@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,7){\line(1,0){120}}
\put(0,0){\line(0,1){7}}
\put(14,0){\line(0,1){7}}
\put(67,0){\line(0,1){7}}
\put(0,0){\parbox[b][7mm][c]{14mm}{%
  \centering\ESKDfontIII\ESKDtheColumnXXVII}}
\put(14,2.3){\makebox[53mm][c]{\ESKDfontIII\ESKDtheColumnXXVIII}}
\put(67,2.3){\makebox[53mm][c]{\ESKDfontIII\ESKDtheColumnXXIX}}
\end{picture}}}

% графа 30
\newsavebox{\ESKD@column@xxx@box}
\newcommand{\ESKD@make@column@xxx@box}{%
\savebox{\ESKD@column@xxx@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,8){\line(1,0){120}}
\put(0,0){\line(0,1){8}}
\put(1,1){\parbox[b][6mm][c]{118mm}{\centering\ESKDfontV\ESKDtheColumnXXX}}
\end{picture}}}

% графа 33
\newsavebox{\ESKD@column@xxxiii@box}
\newcommand{\ESKD@make@column@xxxiii@box}{%
\savebox{\ESKD@column@xxxiii@box}{%
\setlength{\unitlength}{1mm}%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\put(0,25){\line(1,0){20}}
\put(0,5){\line(1,0){20}}
\put(0,0){\line(1,0){20}}
\put(0,0){\line(0,1){25}}
\linethickness{\ESKDlineThin}
\multiput(0,20)(0,-5){3}{\line(1,0){20}}
\put(0,1.3){\makebox[20mm][c]{\ESKDfontIII\ESKDcolumnXXXIIIname}}
\end{picture}}}

% графа 34
\newsavebox{\ESKD@column@xxxiv@box}
\newcommand{\ESKD@make@column@xxxiv@box}{%
\savebox{\ESKD@column@xxxiv@box}{%
\setlength{\fboxrule}{\ESKDlineThick}%
\setlength{\fboxsep}{1.3mm}%
\parbox[b][100mm+\fboxrule][t]{70mm+\fboxrule}{%
  \framebox{%
    \parbox{70mm-2\fboxsep-\fboxrule}{\centering\ESKDfontIII%
      \ESKDtheColumnXXXIV\rule{0mm}{7mm-2\fboxsep-\fboxrule}}}}}}

% обозначения зон
\newcommand{\ESKD@make@h@zonelabels}{
  \ESKD@tmpcnta = 1
  \ESKD@tmpdima = \paperwidth
  \ESKD@tmpdimb = \ESKDframeY
  \advance \ESKD@tmpdimb \ESKDframeH
  \ESKD@tmpdimc = \ESKDframeY
  \advance \ESKD@tmpdimc -5mm
  \loop
    \advance \ESKD@tmpdima -\ESKD@zonelabel@hs
    \global\advance \ESKD@zonelabel@cnt 1
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
      \parbox[b][5mm][c]{\ESKD@zonelabel@hs}{%
	\centering\ESKDfontIII\number\ESKD@zonelabel@cnt}}
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimc}){%
      \parbox[b][5mm][c]{\ESKD@zonelabel@hs}{%
	\centering\ESKDfontIII\number\ESKD@zonelabel@cnt}}
  \ifnum \ESKD@tmpcnta < \ESKD@zonelabel@hc
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){\line(0,1){5}}
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimc}){\line(0,1){5}}
    \advance \ESKD@tmpcnta 1
  \repeat
}
\newcommand{\ESKD@make@v@zonelabels}{
  \ESKD@tmpcnta = 1
  \ESKD@tmpdima = 0mm
  \ESKD@tmpdimb = \ESKDframeX
  \advance \ESKD@tmpdimb -5mm
  \ESKD@tmpdimc = \ESKDframeX
  \advance \ESKD@tmpdimc \ESKDframeW
  \loop
    \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
      \parbox[b][\ESKD@zonelabel@vs][c]{5mm}{%
	\centering\ESKDfontIII\@Alph\ESKD@tmpcnta
	\ifnum\ESKD@tmpcnta = 1
	  \ifESKD@enable@columns@xix
	    \par\rule{0mm}{3.5mm-\ESKD@zonelabel@vs+310mm}
	  \fi
	\fi}}
    \put(\ESKDltu{\ESKD@tmpdimc},\ESKDltu{\ESKD@tmpdima}){%
      \parbox[b][\ESKD@zonelabel@vs][c]{5mm}{%
	\centering\ESKDfontIII\@Alph\ESKD@tmpcnta}}
  \ifnum \ESKD@tmpcnta < \ESKD@zonelabel@vc
    \advance \ESKD@tmpdima \ESKD@zonelabel@vs
    \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){\line(1,0){5}}
    \put(\ESKDltu{\ESKD@tmpdimc},\ESKDltu{\ESKD@tmpdima}){\line(1,0){5}}
    \advance \ESKD@tmpcnta 1
  \repeat
}
\newcommand{\ESKD@zonelabels@i@var}{%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\ESKD@make@h@zonelabels
\ESKD@make@v@zonelabels
\ifdim \ESKD@margin@si > 5mm
  \ESKD@tmpdima = \ESKDframeY
  \ESKD@tmpdimb = \ESKDframeX
  \advance \ESKD@tmpdimb -5mm
  \ifESKD@enable@columns@xix\else
    \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
      \line(0,1){145}}
  \fi
  \advance \ESKD@tmpdima 145mm
  \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
    \line(0,1){22}}
  \advance \ESKD@tmpdima 22mm
  \ifESKD@enable@columns@xxiv\else
    \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
      \line(0,1){120}}
  \fi
  \advance \ESKD@tmpdima 120mm
  \ESKD@tmpdimc = \ESKDframeY
  \advance \ESKD@tmpdimc \ESKDframeH
  \advance \ESKD@tmpdimc -\ESKD@tmpdima
  \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
    \line(0,1){\ESKDltu{\ESKD@tmpdimc}}}
  \advance \ESKD@tmpdima \ESKD@tmpdimc
  \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
    \line(1,0){5}}
\fi
\end{picture}}
\newcommand{\ESKD@zonelabels@ii@var}{%
\begin{picture}(0,0)(0,0)
\linethickness{\ESKDlineThick}
\ESKD@make@h@zonelabels
\ESKD@make@v@zonelabels
\ifdim \ESKD@margin@si > 5mm
  \ESKD@tmpdima = \ESKDframeY
  \ESKD@tmpdimb = \ESKDframeX
  \advance \ESKD@tmpdimb -5mm
  \ifESKD@enable@columns@xix\else
    \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
      \line(0,1){145}}
  \fi
  \advance \ESKD@tmpdima 145mm
  \ESKD@tmpdimc = \ESKDframeY
  \advance \ESKD@tmpdimc \ESKDframeH
  \advance \ESKD@tmpdimc -\ESKD@tmpdima
  \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
    \line(0,1){\ESKDltu{\ESKD@tmpdimc}}}
  \advance \ESKD@tmpdima \ESKD@tmpdimc
  \put(\ESKDltu{\ESKD@tmpdimb},\ESKDltu{\ESKD@tmpdima}){%
    \line(1,0){5}}
\fi
\end{picture}}

% записать боксы полсе начала документа
\AtBeginDocument{%
  \ESKD@make@frame@box%
  \renewcommand{\ESKD@make@frame@box}{}%
  \ESKD@make@stamp@i@box%
  \renewcommand{\ESKD@make@stamp@i@box}{}%
  \ESKD@make@stamp@ii@box%
  \renewcommand{\ESKD@make@stamp@ii@box}{}%
  \ESKD@make@stamp@ii@a@box%
  \renewcommand{\ESKD@make@stamp@ii@a@box}{}%
  \ESKD@make@stamp@ii@b@box%
  \renewcommand{\ESKD@make@stamp@ii@b@box}{}%
  \ifESKD@enable@columns@xix\ESKD@make@columns@xix@box\fi%
  \renewcommand{\ESKD@make@columns@xix@box}{}%
  \ifESKD@enable@columns@xxiv\ESKD@make@columns@xxiv@box\fi%
  \renewcommand{\ESKD@make@columns@xxiv@box}{}%
  \ifESKD@enable@column@xxvi\ESKD@make@column@xxvi@box\fi%
  \renewcommand{\ESKD@make@column@xxvi@box}{}%
  \ifESKD@enable@columns@xxvii%
    \ESKD@make@columns@xxvii@i@box%
    \ESKD@make@columns@xxvii@ii@box%
    \ESKD@make@column@xxx@box%
  \fi%
  \renewcommand{\ESKD@make@columns@xxvii@i@box}{}%
  \renewcommand{\ESKD@make@columns@xxvii@ii@box}{}%
  \renewcommand{\ESKD@make@column@xxx@box}{}%
  \ifESKD@enable@column@xxxiii\ESKD@make@column@xxxiii@box\fi%
  \renewcommand{\ESKD@make@column@xxxiii@box}{}%
  \ifESKD@enable@column@xxxiv\ESKD@make@column@xxxiv@box\fi%
  \renewcommand{\ESKD@make@column@xxxiv@box}{}}

% определение стилей страниц
\newcommand{\ESKD@style@sh@empty}{0mm}
\newcommand{\ESKD@style@draw@empty}{}

\newcommand{\ESKD@check@columns@xix}{%
  \ifESKD@enable@columns@xix%
    \ESKDonFrontSideOnly{%
      \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKDframeY}){%
        \begin{turn}{90}\usebox{\ESKD@columns@xix@box}\end{turn}}}%
  \fi}

\newcommand{\ESKD@check@columns@xxiv}{%
  \ifESKD@enable@columns@xxiv%
    \setlength{\ESKD@tmpdima}{\ESKDframeY+167mm}
    \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKD@tmpdima}){%
      \begin{turn}{90}\usebox{\ESKD@columns@xxiv@box}\end{turn}}%
  \fi}

\newcommand{\ESKD@check@column@xxvi}{%
  \ifESKD@enable@column@xxvi%
    \ifESKD@column@xxvi@portrait%
      \setlength{\ESKD@tmpdima}{\ESKDframeX+\ESKDframeW-14mm}%
      \setlength{\ESKD@tmpdimb}{\ESKDframeY+\ESKDframeH}%
      \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
	\begin{turn}{270}\usebox{\ESKD@column@xxvi@box}\end{turn}}%
    \else%
      \setlength{\ESKD@tmpdima}{\ESKDframeY+\ESKDframeH-14mm}%
      \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKD@tmpdima}){%
	\usebox{\ESKD@column@xxvi@box}}%
    \fi%
  \fi}

\newcommand{\ESKD@check@columns@xxvii@i}{%
  \ifESKD@enable@columns@xxvii%
    \ifESKD@column@xxvi@portrait%
      \setlength{\ESKD@tmpdima}{\ESKDframeX+\ESKDframeW-14mm}%
      \setlength{\ESKD@tmpdimb}{\ESKDframeY+\ESKDframeH-70mm}%
      \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
	\begin{turn}{270}\usebox{\ESKD@columns@xxvii@i@box}\end{turn}}%
    \else%
      \setlength{\ESKD@tmpdima}{\ESKDframeX+70mm}%
      \setlength{\ESKD@tmpdimb}{\ESKDframeY+\ESKDframeH-14mm}%
      \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
	\usebox{\ESKD@columns@xxvii@i@box}}%
    \fi%
    \setlength{\ESKD@tmpdima}{\ESKDstampX+65mm}%
    \setlength{\ESKD@tmpdimb}{\ESKDstampY+55mm}%
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
      \usebox{\ESKD@column@xxx@box}}%
  \fi}

\newcommand{\ESKD@check@columns@xxvii@ii}{%
  \ifESKD@enable@columns@xxvii%
    \setlength{\ESKD@tmpdima}{\ESKDstampX+65mm}
    \setlength{\ESKD@tmpdimb}{\ESKDstampY+48mm}
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
      \usebox{\ESKD@columns@xxvii@ii@box}}%
    \setlength{\ESKD@tmpdimb}{\ESKDstampY+40mm}%
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
      \usebox{\ESKD@column@xxx@box}}%
  \fi}

\newcommand{\ESKD@check@column@xxxii}{%
  \ifESKD@enable@column@xxxii%
    \setlength{\ESKD@tmpdima}{\ESKDframeX+\ESKDframeW-50mm}%
    \setlength{\ESKD@tmpdimb}{\ESKDframeY-3.7mm}%
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
      \makebox[50mm][r]{\ESKDfontIII\ESKDtheColumnXXXII}}%
  \fi}

\newcommand{\ESKD@check@column@xxxiii}{%
  \ifESKD@enable@column@xxxiii%
    \setlength{\ESKD@tmpdima}{\ESKDstampX-20mm}%
    \setlength{\ESKD@tmpdimb}{\ESKDstampY+30mm}%
    \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
      \usebox{\ESKD@column@xxxiii@box}}%
  \fi}

\newcommand{\ESKD@check@column@xxxiv}{%
  \ifESKD@enable@column@xxxiv%
    \ifESKD@column@xxvi@portrait%
      \setlength{\ESKD@tmpdima}{%
        \ESKDframeX+\ESKDframeW-114mm-.5\ESKDlineThick}%
      \setlength{\ESKD@tmpdimb}{%
        \ESKDframeY+\ESKDframeH+.5\ESKDlineThick}%
      \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
	\begin{turn}{270}\usebox{\ESKD@column@xxxiv@box}\end{turn}}%
    \else%
      \setlength{\ESKD@tmpdima}{\ESKDframeX-.5\ESKDlineThick}%
      \setlength{\ESKD@tmpdimb}{%
        \ESKDframeY+\ESKDframeH-114mm-.5\ESKDlineThick}%
      \put(\ESKDltu{\ESKD@tmpdima},\ESKDltu{\ESKD@tmpdimb}){%
	\usebox{\ESKD@column@xxxiv@box}}%
    \fi%
  \fi}

\newcommand{\ESKD@style@sh@title}{0mm}
\newcommand{\ESKD@style@draw@title}{
  \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKDframeY}){%
    \usebox{\ESKD@frame@box}}%
  \ESKD@check@columns@xix}

\newcommand{\ESKD@style@sh@formI}{%
  \ifESKD@enable@columns@xxvii 63mm\else 55mm\fi}
\newcommand{\ESKD@style@draw@formI}{
  \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKDframeY}){%
    \usebox{\ESKD@frame@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \usebox{\ESKD@stamp@i@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \ESKD@stamp@i@var}
  \ESKD@check@columns@xix
  \ESKD@check@columns@xxiv
  \ESKD@check@column@xxvi
  \ESKD@check@columns@xxvii@i
  \ESKD@check@column@xxxii
  \ESKD@check@column@xxxiii
  \ESKD@check@column@xxxiv
  \ifESKD@zonelabels%
    \put(0,0){\ESKD@zonelabels@i@var}%
  \fi}

\newcommand{\ESKD@style@sh@formII}{%
  \ifESKD@enable@columns@xxvii 55mm\else 40mm\fi}
\newcommand{\ESKD@style@draw@formII}{
  \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKDframeY}){%
    \usebox{\ESKD@frame@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \usebox{\ESKD@stamp@ii@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \ESKD@stamp@ii@var}
  \ESKD@check@columns@xix
  \ESKD@check@columns@xxiv
  \ESKD@check@columns@xxvii@ii
  \ESKD@check@column@xxxii}

\newcommand{\ESKD@style@sh@formIIa}{15mm}
\newcommand{\ESKD@style@draw@formIIa}{
  \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKDframeY}){%
    \usebox{\ESKD@frame@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \usebox{\ESKD@stamp@ii@a@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \ESKD@stamp@ii@a@var}
  \ESKD@check@columns@xix
  \ESKD@check@column@xxvi
  \ESKD@check@column@xxxii
  \ifESKD@zonelabels
    \put(0,0){\ESKD@zonelabels@ii@var}
  \fi}

\newcommand{\ESKD@style@sh@formIIb}{15mm}
\newcommand{\ESKD@style@draw@formIIb}{
  \put(\ESKDltu{\ESKDframeX},\ESKDltu{\ESKDframeY}){%
    \usebox{\ESKD@frame@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \usebox{\ESKD@stamp@ii@b@box}}
  \put(\ESKDltu{\ESKDstampX},\ESKDltu{\ESKDstampY}){%
    \ESKD@stamp@ii@b@var}
  \ESKD@check@columns@xix
  \ESKD@check@column@xxxii}

\newcommand{\ESKD@style@sh@formIIsec}{%
  \ifESKD@twoside%
    \ifodd\c@page\ESKD@style@sh@formIIa\else\ESKD@style@sh@formIIb\fi%
  \else\ESKD@style@sh@formIIa\fi}
\newcommand{\ESKD@style@draw@formIIsec}{%
  \ifESKD@twoside%
    \ifodd\c@page\ESKD@style@draw@formIIa\else\ESKD@style@draw@formIIb\fi%
  \else\ESKD@style@draw@formIIa\fi}

% текущее расстояние от текса до рамки
\newlength{\ESKD@curpad@h}
\newlength{\ESKD@curpad@v}
\setlength{\ESKD@curpad@h}{\ESKD@padding@h}
\setlength{\ESKD@curpad@v}{\ESKD@padding@v}

\RequirePackage{everyshi}
\def\ESKD@Hook{}
\def\ESKD@ThisHook{}
\def\ESKD@extra@Hook{}
\def\ESKD@extra@ThisHook{}
\newcommand{\ESKD@ShipoutPicture}{%
  \bgroup
    \ifESKD@twoside
      \ifodd\c@page
        \ESKDframeX=\ESKD@margin@si
      \else
        \ESKDframeX=\ESKD@margin@so
      \fi
    \else
      \ESKDframeX=\ESKD@margin@si
    \fi
    \ESKDframeY=\ESKD@margin@b
    \ESKDstampX=\ESKDframeX
    \advance\ESKDstampX \ESKDframeW
    \advance\ESKDstampX -185mm
    \ESKDstampY=\ESKDframeY
    \unitlength=1mm
    \global\setbox\@cclv\vbox{%
      \vbox{\let\protect\relax
	\begin{picture}(0,0)(\ESKDltu{\ESKD@origin@x},\ESKDltu{\ESKD@origin@y})%
	  \ifx\ESKD@ThisHook\@empty%
	    \ESKD@Hook\else\ESKD@ThisHook%
	  \fi%
	  \ifx\ESKD@extra@ThisHook\@empty%
	    \ESKD@extra@Hook\else\ESKD@extra@ThisHook%
	  \fi%
	  \global\let\ESKD@ThisHook\@empty%
	  \global\let\ESKD@extra@ThisHook\@empty%
	\end{picture}}%
	\nointerlineskip%
      \box\@cclv}%
  \egroup
}
\EveryShipout{\ESKD@ShipoutPicture}

\RequirePackage{chngpage}

% устанавливает стиль текущей и последующих страниц
\newcommand{\ESKDstyle}[1]{%
\pagestyle{empty}%
\def\ESKD@Hook{\@nameuse{ESKD@style@draw@#1}}%
\changetext{\paperheight-\ESKD@margin@t-\ESKD@margin@b-2\ESKD@curpad@v%
  \expandafter-\@nameuse{ESKD@style@sh@\ifESKD@ignstamp empty\else #1\fi}-\textheight}{}{}{}{}%
\let\ESKD@ThisHook\@empty}

% устанавливает стиль текущей страницы
\newcommand{\ESKDthisStyle}[1]{%
\thispagestyle{empty}%
\def\ESKD@ThisHook{\@nameuse{ESKD@style@draw@#1}}%
\setlength{\vsize}{\paperheight-\ESKD@margin@t-\ESKD@margin@b-2\ESKD@curpad@v%
  \expandafter-\@nameuse{ESKD@style@sh@\ifESKD@ignstamp empty\else #1\fi}}%
\setlength{\@colht}{\vsize}\setlength{\@colroom}{\vsize}}

% команды для размещения дополнительной графики
\newcommand{\ESKDput}[1]{\def\ESKD@extra@Hook{#1}}
\newcommand{\ESKDthisPut}[1]{\def\ESKD@extra@ThisHook{#1}}

%
\newcommand{\ESKDclearDoublePage}{%
  \ifESKD@twoside%
    \clearpage%
    \ifodd\c@page\else\ESKDthisStyle{empty}\rule{0mm}{0mm}\newpage\fi%
  \else\clearpage\fi}

% определение стиля страницы по умолчанию
\ifx\ESKD@default@style\ESKD@cmp@formII%
  \ESKDstyle{formIIsec}
  \AtBeginDocument{\ESKDthisStyle{formII}}
\else
  \ifx\ESKD@default@style\ESKD@cmp@formI%
    \ESKDstyle{formIIsec}
    \AtBeginDocument{\ESKDthisStyle{formI}}
  \else
    \ESKDstyle{\ESKD@default@style}
  \fi
\fi

\newenvironment{ESKDpadding}[2]{%
  \newpage%
  \setlength{\ESKD@curpad@h}{#1}%
  \setlength{\ESKD@curpad@v}{#2}%
  \changepage{%
    2\ESKD@padding@v-2\ESKD@curpad@v}{%
    2\ESKD@padding@h-2\ESKD@curpad@h}{%
    \ESKD@curpad@h-\ESKD@padding@h}{%
    \ESKD@curpad@h-\ESKD@padding@h}{}{%
    \ESKD@curpad@v-\ESKD@padding@v}{}{}{}}{%
  \clearpage%
  \changepage{%
    0pt-(2\ESKD@padding@v-2\ESKD@curpad@v)}{%
    0pt-(2\ESKD@padding@h-2\ESKD@curpad@h)}{%
    0pt-(\ESKD@curpad@h-\ESKD@padding@h)}{%
    0pt-(\ESKD@curpad@h-\ESKD@padding@h)}{}{%
    0pt-(\ESKD@curpad@v-\ESKD@padding@v)}{}{}{}%
  \setlength{\ESKD@curpad@h}{\ESKD@padding@h}%
  \setlength{\ESKD@curpad@v}{\ESKD@padding@v}}

\newenvironment{ESKDzeroPadding}{%
  \begin{ESKDpadding}{0mm}{0mm}}{\end{ESKDpadding}}

% графа 1 -- наименование изделия/документа
\newcommand{\ESKDtheColumnI}{}
\newcommand{\ESKDcolumnI}[1]{\renewcommand{\ESKDtheColumnI}{#1}}
% графа 2 -- обозначение документа
\newcommand{\ESKDtheColumnII}{}
\newcommand{\ESKDcolumnII}[1]{\renewcommand{\ESKDtheColumnII}{#1}}
% графа 3 -- обозначение материала детали
\newcommand{\ESKDtheColumnIII}{}
\newcommand{\ESKDcolumnIII}[1]{\renewcommand{\ESKDtheColumnIII}{#1}}
% графа 4 -- литера
% поле 1
\newcommand{\ESKDtheColumnIVfI}{}
\newcommand{\ESKDcolumnIVfI}[1]{\renewcommand{\ESKDtheColumnIVfI}{#1}}
% поле 2
\newcommand{\ESKDtheColumnIVfII}{}
\newcommand{\ESKDcolumnIVfII}[1]{\renewcommand{\ESKDtheColumnIVfII}{#1}}
% поле 3
\newcommand{\ESKDtheColumnIVfIII}{}
\newcommand{\ESKDcolumnIVfIII}[1]{\renewcommand{\ESKDtheColumnIVfIII}{#1}}
% графа 5 -- масса изделия
\newcommand{\ESKDtheColumnV}{}
\newcommand{\ESKDcolumnV}[1]{\renewcommand{\ESKDtheColumnV}{#1}}
% графа 6 -- масштаб
\newcommand{\ESKDtheColumnVI}{}
\newcommand{\ESKDcolumnVI}[1]{\renewcommand{\ESKDtheColumnVI}{#1}}
% графа 9 -- наименование или различительный индекс предприятия
\newcommand{\ESKDtheColumnIX}{}
\newcommand{\ESKDcolumnIX}[1]{\renewcommand{\ESKDtheColumnIX}{#1}}
% графа 11 -- фамилии лиц, подписывающих документ
% поле 1 -- разработал
\newcommand{\ESKDtheColumnXIfI}{\@author}
\newcommand{\ESKDcolumnXIfI}[1]{\renewcommand{\ESKDtheColumnXIfI}{#1}}
% поле 2 -- проверил
\newcommand{\ESKDtheColumnXIfII}{}
\newcommand{\ESKDcolumnXIfII}[1]{\renewcommand{\ESKDtheColumnXIfII}{#1}}
% поле 3 -- Т.контр
\newcommand{\ESKDtheColumnXIfIII}{}
\newcommand{\ESKDcolumnXIfIII}[1]{\renewcommand{\ESKDtheColumnXIfIII}{#1}}
% поле 4 -- неизвестный
\newcommand{\ESKDtheColumnXIfIV}{}
\newcommand{\ESKDcolumnXIfIV}[1]{\renewcommand{\ESKDtheColumnXIfIV}{#1}}
% поле 5 -- нормист
\newcommand{\ESKDtheColumnXIfV}{}
\newcommand{\ESKDcolumnXIfV}[1]{\renewcommand{\ESKDtheColumnXIfV}{#1}}
% поле 6 -- утвердил
\newcommand{\ESKDtheColumnXIfVI}{}
\newcommand{\ESKDcolumnXIfVI}[1]{\renewcommand{\ESKDtheColumnXIfVI}{#1}}
% графа 19 -- инвентарный номер подлинника по ГОСТ 2.501 68
\newcommand{\ESKDtheColumnXIX}{}
\newcommand{\ESKDcolumnXIX}[1]{\renewcommand{\ESKDtheColumnXIX}{#1}}
% графа 21 -- инвентарный номер подлинника, взамен которого выпущен
% данный подлинник по ГОСТ 2.503-90
\newcommand{\ESKDtheColumnXXI}{}
\newcommand{\ESKDcolumnXXI}[1]{\renewcommand{\ESKDtheColumnXXI}{#1}}
% графа 22 -- инвентарный номер дубликата по ГОСТ 2.502-68
\newcommand{\ESKDtheColumnXXII}{}
\newcommand{\ESKDcolumnXXII}[1]{\renewcommand{\ESKDtheColumnXXII}{#1}}
% графа 24 -- обозначение документа, взамен или на основании
% которого выпущен данный документ
\newcommand{\ESKDtheColumnXXIV}{}
\newcommand{\ESKDcolumnXXIV}[1]{\renewcommand{\ESKDtheColumnXXIV}{#1}}
% графа 25 -- обозначение соответствующего документа, в котором впервые
% записан данный документ
\newcommand{\ESKDtheColumnXXV}{}
\newcommand{\ESKDcolumnXXV}[1]{\renewcommand{\ESKDtheColumnXXV}{#1}}
% графа 27 -- знак, установленный заказчиком в соответствии
% с требованиями нормативно-технической документации и проставляемый
% представителем заказчика
\newcommand{\ESKDtheColumnXXVII}{}
\newcommand{\ESKDcolumnXXVII}[1]{\renewcommand{\ESKDtheColumnXXVII}{#1}}
% графа 28 -- номер решения и год утверждения документации
% соответствующей литеры
\newcommand{\ESKDtheColumnXXVIII}{}
\newcommand{\ESKDcolumnXXVIII}[1]{\renewcommand{\ESKDtheColumnXXVIII}{#1}}
% графа 29 -- номер решения и год утверждения документации
\newcommand{\ESKDtheColumnXXIX}{}
\newcommand{\ESKDcolumnXXIX}[1]{\renewcommand{\ESKDtheColumnXXIX}{#1}}
% графа 30 -- индекс заказчика в соответствии с нормативно-технической
% документацией
\newcommand{\ESKDtheColumnXXX}{}
\newcommand{\ESKDcolumnXXX}[1]{\renewcommand{\ESKDtheColumnXXX}{#1}}
% графа 32 -- обозначение формата листа по ГОСТ 2.301-68
\newcommand{\ESKDtheColumnXXXII}{\@nameuse{ESKD\ESKD@paper Name}}
\newcommand{\ESKDcolumnXXXII}[1]{\renewcommand{\ESKDtheColumnXXXII}{#1}}
% графа 34 -- номера авторских свидетельств на изобретения,
% использованные в данном изделии
\newcommand{\ESKDtheColumnXXXIV}{}
\newcommand{\ESKDcolumnXXXIV}[1]{\renewcommand{\ESKDtheColumnXXXIV}{#1}}

m4_dnl vim:sw=2:ai
